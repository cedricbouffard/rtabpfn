---
title: "rtabpfn"
description: >
  An R interface to the TabPFN (Tabular Prior-Fitted Network)
  foundation model for tabular data
output:
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\\VignetteIndexEntry{rtabpfn}
  %\\VignetteEngine{knitr::rmarkdown}
  %\\VignetteEncoding{UTF-8}
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Overview

**rtabpfn** provides an R interface to [TabPFN](https://github.com/PriorLabs/TabPFN), a foundation model for tabular data. Built on top of `reticulate`, it allows R users to leverage the power of the TabPFN model with support for:

- **Classification** - Binary and multi-class classification with class probabilities
- **Regression** - Regression with quantile predictions and uncertainty estimation
- **SHAP Explanations** - Model interpretability through SHAP values
- **Anomaly Detection** - Unsupervised outlier detection
- **tidymodels Integration** - Works seamlessly with the tidymodels ecosystem

## Installation

```{r, eval = FALSE}
# Install from GitHub
devtools::install_github("cedricbouffard/rtabpfn")
```

## Quick Start

### Setup

First, configure your Python environment:

```{r, eval = FALSE}
library(rtabpfn)

# Auto-detect TabPFN venv or create new one
setup_tabpfn()
```

### Classification

```{r, eval = FALSE}
# Train classification model
model <- tab_pfn_classification(iris[, 1:4], iris$Species)

# Get class predictions
preds <- predict(model, iris[1:5, ], type = "class")

# Get class probabilities
probs <- predict(model, iris[1:5, ], type = "prob")
```

### Regression

```{r, eval = FALSE}
# Train regression model
model <- tab_pfn_regression(mtcars[, -1], mtcars$mpg)

# Get point predictions
preds <- predict(model, mtcars[1:5, ], type = "numeric")

# Get quantile predictions
quantiles <- predict(model, mtcars[1:5, ], 
                     type = "quantiles",
                     quantiles = c(0.1, 0.5, 0.9))

# Get prediction intervals
intervals <- predict(model, mtcars[1:5, ], 
                     type = "conf_int", 
                     level = 0.95)
```

### tidymodels Integration

```{r, eval = FALSE}
library(tidymodels)

# Define the model spec
tab_spec <- tab_pfn(mode = "classification") %>%
  set_engine("tabpfn")

# Use in a workflow
workflow() %>%
  add_formula(Species ~ .) %>%
  add_model(tab_spec) %>%
  fit(iris) %>%
  predict(iris[1:5, ])
```

### SHAP Explanations

```{r, eval = FALSE}
# Install tabpfn-extensions for SHAP support
setup_tabpfn(install_shap = TRUE)

# Calculate SHAP values
shap_vals <- shap_values(model, iris[, 1:4])

# Plot SHAP summary
plot_shap_summary(shap_vals)
```

### Anomaly Detection

```{r, eval = FALSE}
# Install tabpfn-extensions[unsupervised]
setup_tabpfn(install_unsupervised = TRUE)

# Train unsupervised model
model <- tab_pfn_unsupervised(mtcars[, 1:4])

# Calculate anomaly scores
scores <- anomaly_scores(model, mtcars[, 1:4])
```

## Key Features

### Quantile Predictions

TabPFN provides uncertainty estimates through quantile regression:

```{r, eval = FALSE}
preds <- predict(model, new_data,
                 type = "quantiles",
                 quantiles = c(0.025, 0.25, 0.5, 0.75, 0.975))
```

### SHAP Values

Explain model predictions using SHAP values:

```{r, eval = FALSE}
shap_vals <- shap_values(model, new_data)
plot_shap_summary(shap_vals)
plot_shap_dependence(shap_vals, feature = "hp")
```

### Multiple Output Types

Support for different prediction types:

- Classification: `type = "class"`, `type = "prob"`, `type = "raw"`
- Regression: `type = "numeric"`, `type = "quantiles"`, `type = "conf_int"`, `type = "raw"`

## Citation

If you use rtabpfn, please cite the TabPFN paper:

```bibtex
@article{tabpfn2024,
  title={TabPFN: A Transformer That Solves Small Tabular Classification Problems in a Second},
  author={MÃ¼ller, Samuel and Holl, Kathrin and Tornede, Alexander and Fischer, Davis and Hennig, Philipp and Roth, Volker and Keuper, Janis},
  journal={Nature},
  volume={626},
  pages={817--824},
  year={2024},
  publisher={Nature Publishing Group}
}
```

## References

- [TabPFN GitHub](https://github.com/PriorLabs/TabPFN)
- [TabPFN Paper (Nature 2024)](https://www.nature.com/articles/s41586-024-08328-6)
- [Prior Labs](https://priorlabs.ai/)
- [tabpfn-extensions](https://pypi.org/project/tabpfn-extensions/)
